<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Mobile Studio v0.0.1</title>
    <link rel="stylesheet" href="css/startup.css">
    <script>window.$ = window.jQuery = require('./js/jquery-3.0.0.min.js');</script>
    <script>window.FSM = require('./js/FileSystemManager.js');</script>

    <script>
        var workingPath = null;
        var projectName = null;
        
        $(window).ready(function(){    
                        
            //require('shelljs/global');        Questo provoca ERRORONI!
            
            //checkIfNativeScriptIsPresent();
            
            
            $("#createNewProject").on("click", function(){
                    $("#firstScreen").addClass("animate");
                    $("#secondScreen").addClass("animate");   
            });
            
            $("#startEditorBtn").on("click", function(event){
                event.preventDefault();
                openEditorAndClose();  
            });
            $("#btnDir").on("click",function(event){
                event.preventDefault();
                selectDir();
            });
            
            
            retriveProjects();
            
        });
        
        function retriveProjects(){
            const {app} = require('electron').remote;
            var homePath = app.getPath("userData");
            fs = require('fs');
            console.log(homePath+"/history");
            fs.readFile(homePath+"/history", 'utf8', function (err,data) {
              if (err) {
                return console.log(err);
              }
              console.log("now showing raw data ");
               strData = "["+data+"]";
              //console.log(strData);
              strData = strData.replace(/}{/g,'},{');
              var dataJSON = JSON.parse(strData);
              /*console.log("now showing parsed data");
              console.log(dataJSON);*/
              /*$("#projectsDrawer").append("<h2>"+dataJSON.name+"</h2>");
              $("#projectsDrawer").append("<h3>"+dataJSON.path+"</h3>");*/
              for(var i = 0; i<dataJSON.length; i++){
                $("#listContainer").append(`
                    <div class="content-prj">
                        <h2>`+dataJSON[i].name+`</h2>
                        <h3>`+dataJSON[i].path+`</h3>
                    </div> 
                `);
               }
              $(".content-prj").click(function(){
                  const {ipcRenderer} = require('electron');
                  ipcRenderer.send('asynchronous-message', ["startEditor", $(this).find("h2").text(), $(this).find("h3").text(), true]);
              });
            });
        }
        
       /* function checkIfNativeScriptIsPresent(){
            /*try {
                console.log(require.resolve("tns"));
            } catch(e) {
                alert("Warning: NativeScript has not been found in your system. NativeScript is needed to run Mobile Studio, please install it. ");
                window.close();
            }
            if (!which('blablabla')) {
              alert('Sorry, this script requires BlaBlaBla!!!');
              exit(1);
            }
        }*/
        
        function openEditorAndClose(){
            const {ipcRenderer} = require('electron');
            if(!workingPath){ alert("Please specify a valid folder"); return; }
            projectName = $("#nameProject").val();
            if (projectName=="") alert("Please insert a name for the project");
            /*var fs = new FileSystemManager(workingPath);
            alert(fs.getWorkingPath);*/
            else ipcRenderer.send('asynchronous-message', ["startEditor", workingPath, projectName, false]);
        }
        
        
        function selectDir(){
            const {dialog} = require('electron').remote;
            
            workingPath = dialog.showOpenDialog({properties: ['openDirectory']});
            
            $("#dirProject").val(workingPath);
            }
        

    </script>
  </head>
  <body>
      <section id="firstScreen">
          <h2>Welcome</h2>
          <img src="img/mainIcon.png"/>


          <h1><strong>Mobile</strong> Studio</h1>
          <h4>The first cross-platform IDE for cross-platform mobile apps</h4>
          <br>
          <section id="projectsDrawer">
                <h1>Your Projects</h1>
                <section id="listContainer"></section>
                <button id="createNewProject">Create a new app</button>
          </section>
      </section>
      <section id="secondScreen">
          <form>
              <input id="nameProject" class="textInput" type="text" placeholder="Give a name to your fantastic project"/>
              <br><input id="dirProject" class="textInput" type="text" placeholder="Select project folder"/>
              <button id="btnDir">...</button>
              <br>
         
              Build for
              <br/>
              <input type="checkbox">Android<br>
              <input type="checkbox">iOS<br>
              <br><br>
              <button id="startEditorBtn">Start Editor</button>
          </form>
      </section>
  </body>
</html>